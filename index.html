<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>🎮 لعبة بطاقات الأسئلة — نسخة مبسّطة بدون إعدادات</title>
  <style>
    :root{
      --bg:#f0f8ff; --card:#ffffff; --ink:#17223b; --muted:#6b7280; --accent:#10b981; --danger:#ef4444; --brand:#3b82f6; --sky:#aee7ff;
      --shadow:0 15px 30px rgba(23,34,59,.15);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Cairo,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:var(--bg);color:var(--ink);font-size:2rem}

    /* شاشة البداية */
    #start{position:fixed;inset:0;background:linear-gradient(180deg,var(--bg),var(--sky));display:flex;align-items:center;justify-content:center;padding:30px;z-index:1000}
    .start-card{max-width:900px;width:100%;background:#ffffffcc;backdrop-filter:blur(6px);border-radius:30px;box-shadow:var(--shadow);padding:40px;text-align:center}
    .start-title{font-size:3.2rem;margin:0 0 10px}
    .start-sub{color:#0c4a6e;margin:0 0 20px}
    .name-row{display:flex;gap:16px;justify-content:center;flex-wrap:wrap;margin-top:20px}
    .name-row input{font-size:1.8rem;padding:18px 20px;border-radius:16px;border:2px solid #93c5fd;min-width:320px}

    .container{max-width:1600px;margin:auto;padding:40px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
    h1{font-size:2.4rem;margin:0;display:flex;gap:16px;align-items:center}
    .chip{font-size:1.3rem;padding:10px 18px;border-radius:999px;background:#e0f2ff;color:#0c4a6e}
    .card{background:var(--card);border-radius:28px;box-shadow:var(--shadow);padding:32px}
    .btn{border:0;border-radius:20px;padding:18px 28px;font-weight:700;cursor:pointer;font-size:1.4rem}
    .btn.primary{background:var(--brand);color:#fff}
    .btn.ghost{background:#e0f2ff;color:#0c4a6e}

    /* HUD */
    .hud{display:flex;justify-content:space-between;align-items:center;gap:16px;margin-bottom:20px;font-size:1.4rem}
    .hud .pill{background:#f1f5f9;color:#334155;padding:12px 20px;border-radius:999px;white-space:nowrap}
    .progress{height:18px;background:#e0f2ff;border-radius:999px;overflow:hidden;margin-bottom:20px}
    .progress>div{height:100%;background:linear-gradient(90deg,#34d399,#10b981);width:0%}

    /* لوح البطاقات */
    #cardBoard{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px}
    .qcard{
      position:relative;background:#fff;border-radius:26px;box-shadow:0 12px 28px rgba(15,23,42,.12);
      min-height:260px;display:flex;align-items:center;justify-content:center;cursor:pointer;
      border:5px solid transparent;transition:.25s;
      background-image:radial-gradient( circle at 20% 20%, #e6f3ff 0, transparent 50% ),
                       radial-gradient( circle at 80% 80%, #e9fff6 0, transparent 50% );
    }
    .qcard:hover{transform:translateY(-6px)}
    .qcard.done{opacity:.25;pointer-events:none;transform:none}
    .qcard.correct{border-color:var(--accent)}
    .qcard.wrong{border-color:var(--danger)}
    .qcard .centerMark{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;padding:14px}
    .qcard .centerMark .num{font-size:5.2rem;font-weight:900;line-height:1;color:#0c4a6e;text-shadow:0 4px 12px rgba(2,6,23,.08)}
    .qcard .centerMark img{width:190px;height:170px;object-fit:contain;opacity:.95;filter:drop-shadow(0 6px 14px rgba(2,6,23,.12))}

    /* مودال السؤال */
    #qModal{position:fixed;inset:0;background:rgba(15,23,42,.35);display:none;align-items:center;justify-content:center;z-index:1100}
    #qBox{background:#fff;border-radius:26px;box-shadow:var(--shadow);width:min(1020px,95vw);max-height:90vh;overflow:auto}
    #qHead{display:flex;justify-content:space-between;align-items:center;padding:18px 22px;border-bottom:1px solid #e5e7eb}
    #qTitle{font-size:1.4rem;margin:0}
    #qBody{padding:16px 22px}
    .question{font-size:3.6rem;font-weight:900;margin:14px 0 22px;text-align:center;line-height:1.25}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
    .choice{position:relative;border:4px solid transparent;border-radius:18px;background:#ffffff;cursor:pointer;transition:.25s;box-shadow:0 10px 24px rgba(17,24,39,.12);font-size:1.6rem}
    .choice:hover{transform:translateY(-4px)}
    .choice.is-correct{border-color:var(--accent)}
    .choice.is-wrong{border-color:var(--danger)}
    .choice[disabled]{opacity:.5;filter:grayscale(.1);cursor:not-allowed}
    .choice .thumb{height:200px;display:flex;align-items:center;justify-content:center;background:#f8fafc;border-radius:14px 14px 0 0;overflow:hidden}
    .choice .thumb img{max-width:100%;max-height:100%}
    .choice .label{padding:14px 16px;font-weight:700;text-align:center}

    /* اهتزاز خطأ */
    @keyframes shakeX {0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
    .shake{animation:shakeX .35s ease}

    .result{display:none;text-align:center;padding:40px;font-size:1.6rem}
    .result h2{font-size:2.4rem;margin:0 0 20px}
    .stats{display:flex;flex-wrap:wrap;gap:16px;justify-content:center;margin-top:16px}
    .stat{background:#f8fafc;border:2px solid #e0f2ff;border-radius:18px;padding:14px 18px;font-size:1.4rem}

    /* صور وتأثيرات */
    .happy-img, .sad-img {position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; z-index: 1202; width: min(420px, 70vw); height: auto; max-height: 70vh}
    #clapOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(240,248,255,.6);z-index:1201}
    #clapOverlay img{width:360px;height:360px;animation:pulse .7s ease-in-out infinite alternate}
    @keyframes pulse{from{transform:scale(.92)}to{transform:scale(1.06)}}

    /* قوس قزح + نجوم */
    #celebrate{pointer-events:none;position:fixed;inset:0;z-index:1200}
    #celebrate #rainbow{position:absolute;left:0;right:0;top:-120vh;height:120vh;opacity:.85;filter:saturate(1.2) blur(1px);background:linear-gradient(180deg,#ff3b30,#ff9500,#ffd60a,#34c759,#64d2ff,#0a84ff,#bf5af2);transform:translateY(-120vh)}
    .rainbow-run{animation:rainbowDrop 1.3s ease-out forwards}
    @keyframes rainbowDrop{0%{transform:translateY(-120vh)}70%{transform:translateY(20vh)}100%{transform:translateY(120vh);opacity:0}}
    .star{position:absolute;font-size:32px;opacity:0;filter:drop-shadow(0 6px 6px rgba(0,0,0,.15));will-change:transform,opacity;}
    @keyframes starFall{0%{transform:translateY(-40px) scale(.6) rotate(0deg);opacity:0}10%{opacity:1}70%{transform:translateY(60vh) scale(1) rotate(160deg)}100%{transform:translateY(100vh) scale(.9) rotate(260deg);opacity:0}}

    /* ولد يرقص */
    @keyframes dance {0%{transform:translate(-50%,-50%) rotate(0) scale(1)}50%{transform:translate(-50%,-50%) rotate(8deg) scale(1.08)}100%{transform:translate(-50%,-50%) rotate(0) scale(1);opacity:0}}
    .dance-run{animation:dance 1.6s ease-in-out forwards;filter:drop-shadow(0 10px 25px rgba(0,0,0,.18));}

    /* Toast */
    #toast{position:fixed; left:50%; top:24px; transform:translateX(-50%) translateY(-20px); background:#ffffff; color:#0f172a; border:2px solid #e2e8f0; border-radius:16px; padding:12px 18px; box-shadow:0 10px 24px rgba(2,6,23,.12); font-size:3.4rem; z-index:1305; opacity:0; pointer-events:none; display:flex; align-items:center; gap:10px; white-space:nowrap;}
    #toast.ok{border-color:#86efac}
    #toast.err{border-color:#fecaca}
    .toast-show{animation:toastIn .25s ease-out forwards}
    .toast-hide{animation:toastOut .25s ease-in forwards}
    @keyframes toastIn{from{opacity:0; transform:translateX(-50%) translateY(-20px)} to{opacity:1; transform:translateX(-50%) translateY(0)}}
    @keyframes toastOut{from{opacity:1; transform:translateX(-50%) translateY(0)} to{opacity:0; transform:translateX(-50%) translateY(-20px)}}

    @media (max-width:640px){
      body{font-size:1.4rem}
      .container{padding:20px}
      .question{font-size:2.2rem}
      #cardBoard{grid-template-columns:repeat(2,1fr);gap:14px}
      .qcard{min-height:200px}
      .choice .thumb{height:170px}
      .btn{padding:16px 18px;font-size:1.2rem}
      .qcard .centerMark .num{ font-size:3.6rem }
      .qcard .centerMark img{ width:64px; height:64px }
    }

    /* ===== هدية + بالونات (تأثير الإجابة الصحيحة) ===== */
    #giftOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:1600;background:rgba(0,0,0,.35)}
    .gift-wrap{position:relative;width:min(360px,80vw);aspect-ratio:1/1;display:flex;align-items:center;justify-content:center}
    .gift{position:relative;width:72%;height:72%}
    .gift .box{position:absolute;left:50%;top:50%;transform:translate(-50%,-30%);width:100%;height:70%;background:#ff5c5c;border-radius:16px;box-shadow:0 14px 30px rgba(0,0,0,.25) inset;}
    .gift .lid{position:absolute;left:50%;top:20%;transform:translate(-50%,-50%);transform-origin:center bottom;width:108%;height:26%;background:#ff7b7b;border-radius:14px;box-shadow:0 8px 18px rgba(0,0,0,.25);}
    .gift .ribbon-vert{position:absolute;left:50%;top:50%;transform:translate(-50%,-30%);width:14%;height:70%;background:#ffd54f;border-radius:10px;}
    .gift .ribbon-horz{position:absolute;left:50%;top:20%;transform:translate(-50%,-50%);width:108%;height:22%;background:linear-gradient(0deg,#ffd54f,#ffec99);border-radius:12px;}
    @keyframes lidOpen{0%{transform:translate(-50%,-50%) rotateX(0)}60%{transform:translate(-50%,-85%) rotateX(-70deg)}100%{transform:translate(-50%,-120%) rotateX(-110deg)}}
    .gift.open .lid{animation:lidOpen .7s ease-out forwards}
    #balloons{position:absolute;inset:0;overflow:visible;pointer-events:none}
    .balloon{position:absolute;bottom:20%;left:50%;width:48px;height:62px;border-radius:50% 50% 45% 45%;background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.7), transparent 35%), var(--bcol,#ff8a80);box-shadow:0 10px 18px rgba(0,0,0,.18)}
    .balloon::after{content:"";position:absolute;left:50%;bottom:-34px;width:2px;height:36px;background:#555;transform:translateX(-50%);border-radius:2px;opacity:.7}
    @keyframes floatUp{0%{transform:translateY(0) scale(.95);opacity:0}10%{opacity:1}100%{transform:translateY(-90vh) scale(1.05);opacity:0}}
    .balloon.run{animation:floatUp var(--dur,1.8s) cubic-bezier(.22,.8,.26,.99) var(--del,0s) forwards}
    .gifts{position:absolute;left:50%;top:46%;transform:translate(-50%,-50%);font-size:44px;opacity:0;filter:drop-shadow(0 6px 10px rgba(0,0,0,.2))}
    @keyframes popGifts{0%{transform:translate(-50%,-30%) scale(.7);opacity:0}40%{opacity:1}100%{transform:translate(-50%,-150%) scale(1.05);opacity:0}}
    .gifts.run{animation:popGifts 1.1s ease-out forwards}

    /* ===== تحسينات تجاوبية مدمجة (غير مكسّرة) ===== */

    /* شاشات أصغر جدًا (≤ 360px) */
    @media (max-width: 360px){
      body{ font-size:1.2rem }
      .container{ padding:16px }
      .start-card{ padding:20px; border-radius:20px }
      .start-title{ font-size:2.2rem }
      .name-row{ gap:10px }
      .name-row input{ min-width:0; width:100%; font-size:1.2rem; padding:12px 14px }
      .btn{ padding:12px 14px; font-size:1.05rem; border-radius:14px }

      #cardBoard{ grid-template-columns:repeat(2,1fr); gap:10px }
      .qcard{ min-height:160px; border-width:4px }
      .qcard .centerMark .num{ font-size:2.8rem }
      .qcard .centerMark img{ width:56px; height:56px }

      #qBox{ width:96vw; max-height:82vh }
      .question{ font-size:1.9rem }
      .choice{ font-size:1.2rem }
      .choice .thumb{ height:130px }
      .choice .thumb img{ max-width:100%; height:auto }
    }

    /* landscape على هواتف قصيرة (≤ 540px ارتفاعًا) */
    @media (max-height: 540px) and (orientation: landscape){
      body{ font-size:1.1rem }
      #start{ align-items:flex-start; padding-top:8px }
      .start-card{ margin-top:8px }
      .container{ padding:16px }
      .hud{ gap:8px; font-size:1.2rem; flex-wrap:wrap }
      .pill{ padding:8px 12px }
      .progress{ height:12px }
      .qcard{ min-height:140px }
      .choice .thumb{ height:110px }
      #qBox{ max-height:78vh }
    }

    /* تابلت (640–900px): شبكة 3 أعمدة */
    @media (min-width: 641px) and (max-width: 900px){
      #cardBoard{ grid-template-columns:repeat(3,1fr) }
    }

    /* شاشات كبيرة جدًا (≥ 1601px) */
    @media (min-width: 1601px){
      body{ font-size:2.2rem }
      .container{ max-width:min(1800px, 92vw) }
      .qcard{ min-height:320px }
      .qcard .centerMark .num{ font-size:6rem }
      .choice .thumb{ height:240px }
    }

    /* صندوق السؤال: حماية قياسات */
    #qModal{ padding:10px }
    #qBox{ max-width:100%; width:min(1020px, 96vw) }
    @supports (width: min(100%, 100%)){
      #qBox{ width:min(1020px, 96vw) }
    }

    /* أهداف لمس مريحة للخيارات */
    .choice{ min-height: calc(200px + 3.2em) }

    /* iOS Safe Areas + توست */
    @supports (padding: max(0px)){
      body{
        padding-inline: max(0px, env(safe-area-inset-left)) max(0px, env(safe-area-inset-right))
      }
      #toast{ top: max(24px, env(safe-area-inset-top)) }
    }

    /* احترام تفضيل تقليل الحركة */
    @media (prefers-reduced-motion: reduce){
      *{
        animation-duration:.01ms !important;
        animation-iteration-count:1 !important;
        transition:none !important;
        scroll-behavior:auto !important;
      }
    }

    /* تباين أعلى لمن يحتاجه */
    @media (prefers-contrast: more){
      .chip,.pill{ border:1px solid #0c4a6e }
      .qcard{ box-shadow:none; border-width:3px }
    }


    /* ===== باتش مرونة أقوى للجوالات (ألصقه أسفل الملف) ===== */

/* 1) خط سائل آمن للجوالات الشائعة (360–430px) */
@media (max-width: 430px){
  /* يقلّل تضخيم الخط العام */
  body{ font-size:1.1rem }
  /* توست أصغر */
  #toast{ font-size:2rem; padding:10px 14px }
  /* HUD يلف بدون زحمة */
  .hud{ gap:8px; font-size:1.1rem; flex-wrap:wrap }
  .hud .pill{ padding:8px 12px }
  /* شبكة بطاقات أدق */
  #cardBoard{ grid-template-columns:repeat(2,1fr); gap:10px }
  .qcard{ min-height:170px; border-width:4px }
  .qcard .centerMark .num{ font-size:3rem }
  .qcard .centerMark img{ width:60px; height:60px }
  /* المودال أقصر */
  #qBox{ width:94vw; max-height:78vh }
  .question{ font-size:1.8rem }
  .choice{ font-size:1.15rem }
  .choice .thumb{ height:120px }
}

/* 2) هواتف صغيرة جدًا (≤ 360px) — عمود واحد عند الضيق الشديد */
@media (max-width: 340px){
  /* في هواتف قديمة أو تصغير متصفح */
  #cardBoard{ grid-template-columns:1fr; gap:8px }
  .qcard{ min-height:160px }
  .choice .thumb{ height:110px }
}

/* 3) landscape على جوالات قصيرة الارتفاع: خفّض كل شيء أكثر */
@media (max-height: 520px) and (orientation: landscape){
  body{ font-size:1rem }
  .container{ padding:12px }
  .hud{ font-size:1rem; gap:6px }
  .progress{ height:10px }
  #cardBoard{ gap:8px }
  .qcard{ min-height:140px }
  #qBox{ max-height:74vh }
  .choice .thumb{ height:100px }
  #toast{ font-size:1.6rem }
}

/* 4) بداية اللعبة: منع كسر بسبب min-width على المدخل */
@media (max-width: 430px){
  .name-row input{
    min-width:0; width:100%; font-size:1rem; padding:12px 14px
  }
  .btn{ padding:12px 14px; font-size:1rem; border-radius:14px }
  .start-card{ padding:22px }
  .start-title{ font-size:2rem }
}

/* 5) تحسينات استعمالية صغيرة */
@supports (padding: max(0px)){
  /* لا تجعل التوست يصطدم بالنوتش */
  #toast{ top: max(16px, env(safe-area-inset-top)) }
}
/* قلّل الاهتزاز على الأجهزة الضعيفة مع تفضيل تقليل الحركة */
@media (prefers-reduced-motion: reduce){
  .shake{ animation-duration:.01ms !important }
}

.nav {
    display: flex
;
    position: relative;
    justify-content: space-between;
    flex-wrap: wrap;
}


  </style>
</head>
<body>
  <!-- شاشة البداية -->
  <section id="start" aria-modal="true">
    <div class="start-card">
      <div style="font-size:4rem">🌟</div>
      <h2 class="start-title">لعبة بطاقات الأسئلة الممتعة</h2>
      <p class="start-sub">اكتب اسمك ثم اضغط ابدأ اللعب</p>
      <div class="name-row">
        <input id="playerName" type="text" placeholder="اكتب اسمك يا بطل" />
        <button class="btn primary" id="goBtn">ابدأ اللعب</button>
      </div>
    </div>
  </section>

  <div class="container" aria-live="polite">
      <div class="nav">
      <div><h1>🎮 أسئلة الأطفال <span class="chip">بطاقات</span></h1></div>
      <div><p class="chip name">إعداد الطالب: عبدالعزيز الحجاب - بإشراف المعلمة: وفاء البلوي</p></div>
      </div>
    <section id="game" class="card" style="display:none">
      <div class="hud">
        <div class="pill" id="timer">⏱️ 00:00</div>
        <div class="pill" id="firstTry">✅ بطاقات صحيحة: 0</div>
        <div class="pill" id="wrongHud">❌ محاولات خاطئة: 0</div>
        <div class="pill" id="qIndex">بطاقات متبقية: 0</div>
      </div>
      <div class="progress"><div id="progressBar"></div></div>
      <div id="cardBoard"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:16px;color:#64748b">
        <div>اختر بطاقة، أجب، إن كانت خاطئة جرّب مرة أخرى. تختفي البطاقة عند الإجابة الصحيحة.</div>
        <button class="btn ghost" id="restart">🔁 إعادة</button>
      </div>
    </section>

    <section id="result" class="card" style="display:none;text-align:center">
      <h2 id="resultTitle">🎉 أحسنت! لقد أنهيت جميع البطاقات</h2>
      <p id="resultText">…</p>
      <div class="stats">
        <div class="stat">⏱️ الوقت المستغرق: <b id="resultTime">00:00</b></div>
        <div class="stat">✅ بطاقات صحيحة: <b id="resultFirstTries">0</b></div>
        <div class="stat">📚 عدد البطاقات: <b id="resultTotal">0</b></div>
        <div class="stat">❌ إجمالي المحاولات الخاطئة: <b id="resultWrongCount">0</b></div>
      </div>
      <div style="margin-top:28px;display:flex;gap:16px;justify-content:center">
        <button class="btn primary" id="playAgain">🎯 العب مرة أخرى</button>
      </div>
    </section>
  </div>

  <!-- مودال السؤال -->
  <div id="qModal" aria-hidden="true">
    <div id="qBox" role="dialog" aria-labelledby="qTitle">
      <div id="qHead">
        <h3 id="qTitle">السؤال</h3>
        <button class="btn ghost" id="closeModalBtn" title="إغلاق">✖</button>
      </div>
      <div id="qBody">
        <div class="question" id="questionText">…</div>
        <div class="grid" id="choices"></div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" role="status" aria-live="polite"><span id="toastIcon">🎉</span><span id="toastMsg">...</span></div>

  <!-- ===== طبقة صندوق الهدية + البالونات ===== -->
  <div id="giftOverlay">
    <div class="gift-wrap">
      <div class="gift" aria-hidden="true">
        <div class="box"></div>
        <div class="lid"></div>
        <div class="ribbon-vert"></div>
        <div class="ribbon-horz"></div>
      </div>
      <div id="balloons"></div>
      <div class="gifts" id="giftEmojis">🎁✨🍭⭐️🎉</div>
    </div>
  </div>

  <!-- ===== أصوات محلية ===== -->
  <audio id="sfxCorrect" preload="auto" src="sfx-correct.mp3"></audio>
  <audio id="sfxWrong"   preload="auto" src="sfx-wrong.mp3"></audio>

 <script>
  /* أدوات صغيرة */
  function qs(s, r){return (r||document).querySelector(s)}
  function shuffle(arr){ const a = arr.slice(); for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }
  function rand(arr){return arr[Math.floor(Math.random()*arr.length)]}
  function esc(t){return String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;')}

  /* ثابت واحد فقط */
  const QUESTIONS_PER_ROUND = 6;

  /* حالة اللعبة */
  let QUESTIONS=[], CARDS=[], answered=0, correctCount=0, wrongAttempts=0, startAt=0, timerId=null, playerName='';

  /* أيقونة البطاقة (صورة محلية اختيارية) */
  const QMARK = "boy.png";

  /* قاموس الأيقونات */
  const ICONS = {
    "قطة":"https://cdn-icons-png.flaticon.com/128/1998/1998592.png","كلب":"https://cdn-icons-png.flaticon.com/512/616/616408.png","أسد":"https://cdn-icons-png.flaticon.com/128/12541/12541334.png","نمر":"https://cdn-icons-png.flaticon.com/128/1998/1998804.png","فيل":"https://cdn-icons-png.flaticon.com/128/7743/7743300.png","قرد":"https://cdn-icons-png.flaticon.com/128/1998/1998721.png","بقرة":"https://cdn-icons-png.flaticon.com/512/616/616528.png","حصان":"https://cdn-icons-png.flaticon.com/128/9537/9537923.png","جمل":"https://cdn-icons-png.flaticon.com/128/4215/4215091.png","أرنب":"https://cdn-icons-png.flaticon.com/128/1998/1998765.png","طائر":"https://cdn-icons-png.flaticon.com/128/1230/1230870.png","سمكة":"https://cdn-icons-png.flaticon.com/128/2970/2970068.png","ضفدع":"https://cdn-icons-png.flaticon.com/128/8677/8677566.png","بطة":"https://cdn-icons-png.flaticon.com/128/2120/2120233.png","دب":"https://cdn-icons-png.flaticon.com/128/1047/1047479.png","تفاح":"https://cdn-icons-png.flaticon.com/512/415/415733.png","موز":"https://cdn-icons-png.flaticon.com/128/2909/2909761.png","برتقال":"https://cdn-icons-png.flaticon.com/512/415/415734.png","عنب":"https://cdn-icons-png.flaticon.com/128/5376/5376172.png","بطيخ":"https://cdn-icons-png.flaticon.com/128/5582/5582664.png","فراولة":"https://cdn-icons-png.flaticon.com/128/7315/7315465.png","أناناس":"https://cdn-icons-png.flaticon.com/128/8692/8692265.png","ليمون":"https://cdn-icons-png.flaticon.com/512/415/415735.png","جزر":"https://cdn-icons-png.flaticon.com/128/3136/3136973.png","طماطم":"https://cdn-icons-png.flaticon.com/128/1790/1790387.png","بطاطس":"https://cdn-icons-png.flaticon.com/128/1652/1652127.png","كتاب":"https://cdn-icons-png.flaticon.com/128/5832/5832416.png","قلم":"https://cdn-icons-png.flaticon.com/128/2493/2493530.png","ممحاة":"https://cdn-icons-png.flaticon.com/128/776/776194.png","مسطرة":"https://cdn-icons-png.flaticon.com/128/595/595732.png","مقص":"https://cdn-icons-png.flaticon.com/128/10363/10363577.png","مثلث":"https://cdn-icons-png.flaticon.com/128/9796/9796733.png","مربع":"https://cdn-icons-png.flaticon.com/128/6038/6038682.png","دائرة":"https://cdn-icons-png.flaticon.com/128/5111/5111178.png","نجمة":"https://cdn-icons-png.flaticon.com/512/1828/1828884.png","قلب":"https://cdn-icons-png.flaticon.com/512/833/833472.png","ماسة":"https://cdn-icons-png.flaticon.com/128/408/408472.png","سيارة":"https://cdn-icons-png.flaticon.com/128/3097/3097180.png","حافلة":"https://cdn-icons-png.flaticon.com/128/1068/1068631.png","قطار":"https://cdn-icons-png.flaticon.com/128/1974/1974098.png","شاحنة":"https://cdn-icons-png.flaticon.com/128/870/870130.png","دراجة":"https://cdn-icons-png.flaticon.com/512/2972/2972185.png","طائرة":"https://cdn-icons-png.flaticon.com/128/10521/10521422.png","سفينة":"https://cdn-icons-png.flaticon.com/128/18098/18098671.png","هليكوبتر":"https://cdn-icons-png.flaticon.com/128/3097/3097187.png","شمس":"https://cdn-icons-png.flaticon.com/512/869/869869.png","قمر":"https://cdn-icons-png.flaticon.com/128/1823/1823397.png","سحابة":"https://cdn-icons-png.flaticon.com/512/414/414825.png","مطر":"https://cdn-icons-png.flaticon.com/128/8841/8841317.png","ثلج":"https://cdn-icons-png.flaticon.com/512/414/414968.png","شجرة":"https://cdn-icons-png.flaticon.com/128/490/490091.png","زهرة":"https://cdn-icons-png.flaticon.com/128/11504/11504574.png","جبل":"https://cdn-icons-png.flaticon.com/128/619/619010.png","كوب":"https://cdn-icons-png.flaticon.com/128/12974/12974286.png","كرسي":"https://cdn-icons-png.flaticon.com/128/607/607067.png","طاولة":"https://cdn-icons-png.flaticon.com/128/607/607069.png","سرير":"https://cdn-icons-png.flaticon.com/128/2283/2283945.png","ساعة":"https://cdn-icons-png.flaticon.com/128/2997/2997985.png","هاتف":"https://cdn-icons-png.flaticon.com/128/2482/2482945.png","قبعة":"https://cdn-icons-png.flaticon.com/128/1974/1974214.png","قميص":"https://cdn-icons-png.flaticon.com/512/892/892457.png","حذاء":"https://cdn-icons-png.flaticon.com/128/2742/2742687.png","حقيبة":"https://cdn-icons-png.flaticon.com/128/3275/3275938.png","بيتزا":"https://cdn-icons-png.flaticon.com/512/3132/3132693.png","بطاطا_مقلية":"https://cdn-icons-png.flaticon.com/128/1046/1046786.png","آيسكريم":"https://cdn-icons-png.flaticon.com/128/3157/3157358.png","كعكة":"https://cdn-icons-png.flaticon.com/128/2682/2682340.png","بيضة":"https://cdn-icons-png.flaticon.com/128/2168/2168010.png","خبز":"","طبيب":"https://cdn-icons-png.flaticon.com/128/2785/2785482.png","شرطي":"https://cdn-icons-png.flaticon.com/128/3270/3270987.png","معلمة":"https://cdn-icons-png.flaticon.com/128/5369/5369664.png","طيار":"https://cdn-icons-png.flaticon.com/128/10750/10750979.png","رجل_إطفاء":"https://cdn-icons-png.flaticon.com/128/950/950006.png"
  };

  /* بنك أسئلة خام (بدون map مسبق) */
  const QUESTIONS_POOL = [
    {"question":"ما الحيوان الذي يقول ميووو؟","answers":[{"text":"قطة","isCorrect":true},{"text":"كلب"},{"text":"بقرة"}]},
    {"question":"ما الحيوان الذي ينبح؟","answers":[{"text":"كلب","isCorrect":true},{"text":"قطة"},{"text":"سمكة"}]},
    {"question":"ملك الغابة هو؟","answers":[{"text":"أسد","isCorrect":true},{"text":"نمر"},{"text":"قرد"}]},
    {"question":"حيوان له سنام؟","answers":[{"text":"جمل","isCorrect":true},{"text":"حصان"},{"text":"بقرة"}]},
    {"question":"أي حيوان يطير؟","answers":[{"text":"طائر","isCorrect":true},{"text":"قطة"},{"text":"سمكة"}]},
    {"question":"أي حيوان يعيش في الماء؟","answers":[{"text":"سمكة","isCorrect":true},{"text":"أسد"},{"text":"أرنب"}]},
    {"question":"أي حيوان يقفز وله جلد رطب؟","answers":[{"text":"ضفدع","isCorrect":true},{"text":"بطة"},{"text":"قرد"}]},
    {"question":"أي حيوان يقول ماء ماء؟","answers":[{"text":"بطة","isCorrect":true},{"text":"حصان"},{"text":"قطة"}]},
    {"question":"أي حيوان يُحلب؟","answers":[{"text":"بقرة","isCorrect":true},{"text":"أسد"},{"text":"نمر"}]},
    {"question":"أي حيوان سريع للركوب؟","answers":[{"text":"حصان","isCorrect":true},{"text":"قرد"},{"text":"أرنب"}]},
    {"question":"أي فاكهة لونها أصفر ومنحنية الشكل؟","answers":[{"text":"موز","isCorrect":true},{"text":"تفاح"},{"text":"فراولة"}]},
    {"question":"أي فاكهة حمراء وبذورها على سطحها؟","answers":[{"text":"فراولة","isCorrect":true},{"text":"عنب"},{"text":"أناناس"}]},
    {"question":"فاكهة على شكل عناقيد؟","answers":[{"text":"عنب","isCorrect":true},{"text":"تفاح"},{"text":"بطيخ"}]},
    {"question":"أي فاكهة قشرتها برتقالية؟","answers":[{"text":"برتقال","isCorrect":true},{"text":"ليمون"},{"text":"موز"}]},
    {"question":"أي فاكهة كبيرة خضراء من الخارج وحمراء من الداخل؟","answers":[{"text":"بطيخ","isCorrect":true},{"text":"تفاح"},{"text":"عنب"}]},
    {"question":"أي فاكهة صفراء وحامضة؟","answers":[{"text":"ليمون","isCorrect":true},{"text":"تفاح"},{"text":"أناناس"}]},
    {"question":"أي خضار لونه برتقالي؟","answers":[{"text":"جزر","isCorrect":true},{"text":"بطاطس"},{"text":"طماطم"}]},
    {"question":"أي خضار نأكله في البطاطس المقلية؟","answers":[{"text":"بطاطس","isCorrect":true},{"text":"طماطم"},{"text":"جزر"}]},
    {"question":"نستخدمه للكتابة؟","answers":[{"text":"قلم","isCorrect":true},{"text":"ممحاة"},{"text":"مقص"}]},
    {"question":"نستخدمها لمسح الكتابة؟","answers":[{"text":"ممحاة","isCorrect":true},{"text":"قلم"},{"text":"مسطرة"}]},
    {"question":"أي أداة لقياس الطول؟","answers":[{"text":"مسطرة","isCorrect":true},{"text":"مقص"},{"text":"كتاب"}]},
    {"question":"نقطع الورق باستخدامه؟","answers":[{"text":"مقص","isCorrect":true},{"text":"قلم"},{"text":"ممحاة"}]},
    {"question":"ما الذي نقرأه؟","answers":[{"text":"كتاب","isCorrect":true},{"text":"قلم"},{"text":"مقص"}]},
    {"question":"أي شكل له ٤ أضلاع متساوية؟","answers":[{"text":"مربع","isCorrect":true},{"text":"مثلث"},{"text":"دائرة"}]},
    {"question":"أي شكل ليس له زوايا؟","answers":[{"text":"دائرة","isCorrect":true},{"text":"مربع"},{"text":"مثلث"}]},
    {"question":"أي شكل له ٣ أضلاع؟","answers":[{"text":"مثلث","isCorrect":true},{"text":"دائرة"},{"text":"مربع"}]},
    {"question":"رمز الحب هو؟","answers":[{"text":"قلب","isCorrect":true},{"text":"نجمة"},{"text":"ماسة"}]},
    {"question":"أي وسيلة تسير على السكك الحديدية؟","answers":[{"text":"قطار","isCorrect":true},{"text":"سيارة"},{"text":"حافلة"}]},
    {"question":"أي وسيلة تطير في السماء؟","answers":[{"text":"طائرة","isCorrect":true},{"text":"سفينة"},{"text":"دراجة"}]},
    {"question":"أي وسيلة تمشي على الطريق ولها أربع عجلات؟","answers":[{"text":"سيارة","isCorrect":true},{"text":"سفينة"},{"text":"طائرة"}]},
    {"question":"أي وسيلة تنقل الناس داخل المدينة؟","answers":[{"text":"حافلة","isCorrect":true},{"text":"طائرة"},{"text":"دراجة"}]},
    {"question":"أي وسيلة تسير فوق البحر؟","answers":[{"text":"سفينة","isCorrect":true},{"text":"طائرة"},{"text":"سيارة"}]},
    {"question":"ننام على؟","answers":[{"text":"سرير","isCorrect":true},{"text":"كرسي"},{"text":"طاولة"}]},
    {"question":"نجلس على؟","answers":[{"text":"كرسي","isCorrect":true},{"text":"سرير"},{"text":"كوب"}]},
    {"question":"نشرب الماء في؟","answers":[{"text":"كوب","isCorrect":true},{"text":"كتاب"},{"text":"هاتف"}]},
    {"question":"نأكل الطعام على؟","answers":[{"text":"طاولة","isCorrect":true},{"text":"كرسي"},{"text":"كوب"}]},
    {"question":"نرى الوقت بواسطة؟","answers":[{"text":"ساعة","isCorrect":true},{"text":"هاتف"},{"text":"كوب"}]},
    {"question":"نرتدي على الرأس؟","answers":[{"text":"قبعة","isCorrect":true},{"text":"قميص"},{"text":"حذاء"}]},
    {"question":"نلبس في القدمين؟","answers":[{"text":"حذاء","isCorrect":true},{"text":"قبعة"},{"text":"حقيبة"}]},
    {"question":"نلبس في الجسم العلوي؟","answers":[{"text":"قميص","isCorrect":true},{"text":"قبعة"},{"text":"حذاء"}]},
    {"question":"نضع أغراضنا في؟","answers":[{"text":"حقيبة","isCorrect":true},{"text":"كوب"},{"text":"كرسي"}]},
    {"question":"أكلة مستديرة مع الجبن وتُقطع مثلثات؟","answers":[{"text":"بيتزا","isCorrect":true},{"text":"كعكة"},{"text":"بطاطا_مقلية"}]},
    {"question":"حلوى باردة في الصيف؟","answers":[{"text":"آيسكريم","isCorrect":true},{"text":"كعكة"},{"text":"بيتزا"}]},
    {"question":"نأكلها في الفرح أو النجاح؟","answers":[{"text":"كعكة","isCorrect":true},{"text":"بيتزا"},{"text":"بطاطا_مقلية"}]},
    {"question":"نتناولها في الإفطار؟","answers":[{"text":"بيضة","isCorrect":true},{"text":"آيسكريم"},{"text":"كعكة"}]},
    {"question":"من يعالج المرضى؟","answers":[{"text":"طبيب","isCorrect":true},{"text":"شرطي"},{"text":"معلمة"}]},
    {"question":"من يعلّم الطلاب؟","answers":[{"text":"معلمة","isCorrect":true},{"text":"طيار"},{"text":"شرطي"}]},
    {"question":"من يقود الطائرة؟","answers":[{"text":"طيار","isCorrect":true},{"text":"شرطي"},{"text":"طبيب"}]},
    {"question":"من يطفئ النار؟","answers":[{"text":"رجل_إطفاء","isCorrect":true},{"text":"طيار"},{"text":"معلمة"}]},
    {"question":"من يحافظ على الأمن؟","answers":[{"text":"شرطي","isCorrect":true},{"text":"طبيب"},{"text":"رجل_إطفاء"}]},
    {"question":"يظهر في الليل؟","answers":[{"text":"قمر","isCorrect":true},{"text":"شجرة"},{"text":"جبل"}]},
    {"question":"يظهر في النهار؟","answers":[{"text":"شمس","isCorrect":true},{"text":"بحر"},{"text":"كرسي"}]},
    {"question":"ما الذي ينزل من السماء عندما تمطر؟","answers":[{"text":"مطر","isCorrect":true},{"text":"ثلج"},{"text":"تراب"}]},
    {"question":"ما الذي يكون أبيض ويسقط في الشتاء؟","answers":[{"text":"ثلج","isCorrect":true},{"text":"مطر"},{"text":"شمس"}]}
  ];

  /* تنظيف البنك + إلحاق الصور + دفاعية */
  const CLEAN_POOL = (QUESTIONS_POOL || [])
    .filter(q => q && typeof q.question === 'string' && Array.isArray(q.answers) && q.answers.length)
    .map(q => ({
      ...q,
      answers: q.answers
        .filter(a => a && typeof a.text === 'string')
        .map(a => ({ ...a, image: (ICONS[a.text] || a.image || undefined) }))
    }));

  /* HUD */
  const timerEl=qs('#timer'), firstTryEl=qs('#firstTry'), wrongHudEl=qs('#wrongHud'), qIndexEl=qs('#qIndex'), progressBar=qs('#progressBar');
  function fmtTime(ms){const s=Math.floor(ms/1000),m=Math.floor(s/60),r=s%60;return (m<10?'0'+m:m)+':'+(r<10?'0'+r:r)}
  function startTimer(){startAt=performance.now(); tick()}
  function tick(){timerEl.textContent='⏱️ '+fmtTime(performance.now()-startAt); timerId=requestAnimationFrame(tick)}
  function stopTimer(){ if(timerId) cancelAnimationFrame(timerId); timerId=null }

  /* أصوات */
  const sfxOk  = document.getElementById('sfxCorrect');
  const sfxErr = document.getElementById('sfxWrong');
  function playSfx(el){ if(!el) return; try{ el.currentTime = 0; el.play(); }catch(e){} }

  /* تأثير صندوق الهدية */
  function showGiftBox(next){
    const ov=document.getElementById('giftOverlay');
    const balloons=document.getElementById('balloons');
    const gift=ov && ov.querySelector('.gift');
    const emojis=document.getElementById('giftEmojis');
    if(!ov||!gift||!balloons||!emojis){ if(next) next(); return; }

    balloons.innerHTML='';
    emojis.classList.remove('run');
    gift.classList.remove('open');
    ov.style.display='flex';

    requestAnimationFrame(()=>{ gift.classList.add('open'); });

    const colors=['#ff8a80','#ffd54f','#81c784','#64b5f6','#ba68c8','#ffb74d'];
    const count=14+Math.floor(Math.random()*8);
    for(let i=0;i<count;i++){
      const b=document.createElement('div');
      b.className='balloon run';
      b.style.setProperty('--bcol', colors[i%colors.length]);
      b.style.left = (20 + Math.random()*60) + '%';
      b.style.setProperty('--dur', (1.6 + Math.random()*1.2)+'s');
      b.style.setProperty('--del', (0.05 + Math.random()*0.35)+'s');
      balloons.appendChild(b);
    }

    setTimeout(()=>{ emojis.classList.add('run'); }, 200);

    setTimeout(()=>{
      ov.style.display='none';
      gift.classList.remove('open');
      emojis.classList.remove('run');
      if(next) next();
    }, 1800);
  }

  function showHappy(){ const el=qs('#happyImg'); el && (el.style.display='block', setTimeout(()=>{ el.style.display='none'},1500)) }
  function showSad(){ const el=qs('#sadImg'); el && (el.style.display='block', setTimeout(()=>{ el.style.display='none'},900)) }
  function showClap(){ const el=qs('#clapOverlay'); el && (el.style.display='flex', setTimeout(()=>{ el.style.display='none'},1300)) }
  function celebrateRainbowStars(){
    const wrap=qs('#celebrate'), rainbow=qs('#rainbow'); if(!wrap||!rainbow) return;
    rainbow.classList.remove('rainbow-run'); void rainbow.offsetWidth; rainbow.classList.add('rainbow-run');
    Array.from(wrap.querySelectorAll('.star')).forEach(n=>n.remove());
    for(let i=0;i<18;i++){
      const s=document.createElement('div'); s.className='star';
      s.textContent=(Math.random()<0.33?'✨':(Math.random()<0.5?'⭐':'🌟'));
      s.style.left=Math.round(Math.random()*95)+'%'; s.style.top='-20px'; s.style.fontSize=(24+Math.random()*22)+'px';
      const delay=(Math.random()*0.3).toFixed(2)+'s', dur=(1.1+Math.random()*0.8).toFixed(2)+'s';
      s.style.animation='starFall '+dur+' ease-out '+delay+' forwards'; wrap.appendChild(s);
    }
    setTimeout(()=>{ Array.from(wrap.querySelectorAll('.star')).forEach(n=>n.remove()) }, 2200);
  }
  function showDanceBoy(){
    const el=qs('#danceBoy'); if(!el) return;
    el.style.display='block'; el.classList.remove('dance-run'); void el.offsetWidth; el.classList.add('dance-run');
    setTimeout(()=>{ el.style.display='none' },1650);
  }

  /* Toast */
  let toast=null, toastMsg=null, toastIcon=null, toastTimer=null;
  function setupToast(){ toast=qs('#toast'); toastMsg=qs('#toastMsg'); toastIcon=qs('#toastIcon'); }
  function showToast(message, kind){
    if(!toast) setupToast();
    toast.classList.remove('ok','err','toast-hide'); toast.classList.add(kind||'ok');
    toastMsg.textContent = message || ''; toastIcon.textContent = (kind==='err' ? '💡' : '🎉');
    toast.style.display='flex'; void toast.offsetWidth; toast.classList.add('toast-show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=>{ toast.classList.remove('toast-show'); toast.classList.add('toast-hide'); setTimeout(()=>{ toast.style.display='none' },240); },1400);
  }

  /* اختيار أسئلة عشوائية — دفاعي */
  function pickRandomQuestions(pool, n){
    const safe = (pool || [])
      .filter(q => q && Array.isArray(q.answers) && q.answers.length);

    const size = Math.min(Number.isFinite(n) ? n : 6, safe.length);
    const arr = shuffle(safe).slice(0, size);

    return arr.map(q => ({
      ...q,
      answers: shuffle((q && q.answers) ? q.answers : [])
    }));
  }

  /* بطاقات */
  function buildBoard(){
    const board=qs('#cardBoard'); board.innerHTML='';
    CARDS=QUESTIONS.map((q,idx)=>{
      const c=document.createElement('button'); c.className='qcard'; c.setAttribute('data-i',idx); c.setAttribute('aria-label','بطاقة رقم '+(idx+1));
      c.innerHTML='<div class="centerMark"><div class="num">'+(idx+1)+'</div><img src="'+QMARK+'" alt="بطاقة"></div>';
      c.onclick=function(){ openQuestion(idx,c) };
      board.appendChild(c); return c;
    });
    updateHud();
  }
  function updateHud(){
    const total=QUESTIONS.length, remain=total-answered;
    qs('#firstTry').textContent='✅ بطاقات صحيحة: '+correctCount;
    qs('#wrongHud').textContent='❌ محاولات خاطئة: '+wrongAttempts;
    qs('#qIndex').textContent='بطاقات متبقية: '+remain;
    qs('#progressBar').style.width = Math.round((answered/Math.max(1,total))*100) + '%';
  }

  /* مودال */
  function openQuestion(index, cardEl){
    const q=QUESTIONS[index]; if(!q) return;
    const modal=qs('#qModal'); const title=qs('#qTitle'); const qText=qs('#questionText'); const host=qs('#choices');
    title.textContent='السؤال #' + (index+1);
    qText.textContent=q.question;
    host.innerHTML='';
    (q.answers||[]).forEach(a=>{
      const src = ICONS[a.text] || a.image || '';
      const b=document.createElement('button'); b.className='choice'; b.type='button';
      const imgHtml = src ? '<img src="'+src+'" alt="'+esc(a.text)+'">' : '🎲';
      b.innerHTML='<div class="thumb">'+imgHtml+'</div><div class="label">'+esc(a.text)+'</div>';
      b.onclick=function(){ answerWithRetries(b, !!a.isCorrect, cardEl, index) };
      host.appendChild(b);
    });
    modal.style.display='flex'; modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden';
  }
  function closeModal(){ const modal=qs('#qModal'); modal.style.display='none'; modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }
  qs('#closeModalBtn') && (qs('#closeModalBtn').onclick=closeModal);
  document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeModal(); });

  /* منطق الإجابة */
  function answerWithRetries(btn, ok, cardEl){
    const choicesWrap=qs('#choices');
    if(ok){
      choicesWrap.querySelectorAll('.choice').forEach(ch=>{ ch.disabled=true });
      btn.classList.add('is-correct'); cardEl.classList.add('correct');
      correctCount++; answered++;
      playSfx(sfxOk);
      showToast(rand(['رائع يا بطل!','ممتاز! استمر 👏','يا سلام! إجابة صحيحة 🌟']), 'ok');

      showGiftBox(function(){
        if(cardEl && cardEl.parentNode){ cardEl.classList.add('done'); cardEl.remove(); }
        updateHud(); closeModal();
        if(answered >= QUESTIONS.length){ finish(); }
      });

    }else{
      btn.classList.add('is-wrong','shake');
      btn.disabled=true;
      setTimeout(()=>{ btn.classList.remove('shake') }, 350);
      wrongAttempts++;
      playSfx(sfxErr);
      showToast(rand(['لا بأس، حاول مرة أخرى يا بطل! 💪','لا تيأس يا بطل، ستنجح! 🌟','أنت قادر عليها! جرّب مجددًا! 🙌']), 'err');
      setTimeout(()=>{ updateHud(); btn.disabled=false; }, 900);
    }
  }

  function finish(){
    stopTimer();
    const total=QUESTIONS.length||1;
    qs('#resultTime').textContent=fmtTime(performance.now()-startAt);
    qs('#resultFirstTries').textContent=correctCount;
    qs('#resultTotal').textContent=total;
    qs('#resultWrongCount').textContent=wrongAttempts;
    const congrats = playerName ? ('🎉 أحسنت يا '+playerName+'!') : '🎉 أحسنت!';
    qs('#resultTitle').textContent = congrats + ' لقد أنهيت جميع البطاقات';
    qs('#resultText').textContent = (wrongAttempts===0) ? 'مذهل! لم تُخطئ أي محاولة 👏' : 'عمل رائع! المحاولات علمتنا الطريق الصحيح 💪';
    qs('#game').style.display='none';
    qs('#result').style.display='block';
  }

  /* بدء/إعادة — تستخدم CLEAN_POOL */
  function startWithCurrentSettings(){
    QUESTIONS = pickRandomQuestions(CLEAN_POOL, QUESTIONS_PER_ROUND);
  }

  document.getElementById('goBtn').onclick=function(){
    playerName = (document.getElementById('playerName').value||'بطلي').trim();
    if(sfxOk){ try{ sfxOk.play().then(()=>{sfxOk.pause(); sfxOk.currentTime=0;}).catch(()=>{});}catch(e){} }
    if(sfxErr){ try{ sfxErr.play().then(()=>{sfxErr.pause(); sfxErr.currentTime=0;}).catch(()=>{});}catch(e){} }

    startWithCurrentSettings();
    answered=0; correctCount=0; wrongAttempts=0;
    document.getElementById('start').style.display='none';
    document.getElementById('result').style.display='none';
    document.getElementById('game').style.display='block';
    buildBoard(); stopTimer(); startTimer();
  };

  /* تشغيل تلقائي للاختبار */
  function test(){
    playerName = (document.getElementById('playerName').value||'بطلي').trim();
    if(sfxOk){ try{ sfxOk.play().then(()=>{sfxOk.pause(); sfxOk.currentTime=0;}).catch(()=>{});}catch(e){} }
    if(sfxErr){ try{ sfxErr.play().then(()=>{sfxErr.pause(); sfxErr.currentTime=0;}).catch(()=>{});}catch(e){} }

    startWithCurrentSettings();
    answered=0; correctCount=0; wrongAttempts=0;
    document.getElementById('start').style.display='none';
    document.getElementById('result').style.display='none';
    document.getElementById('game').style.display='block';
    buildBoard(); stopTimer(); startTimer();
  };
  test();

  document.getElementById('restart').onclick=function(){
    startWithCurrentSettings();
    answered=0; correctCount=0; wrongAttempts=0;
    buildBoard(); stopTimer(); startTimer();
  };

  document.getElementById('playAgain').onclick=function(){
    document.getElementById('result').style.display='none';
    document.getElementById('game').style.display='block';
    startWithCurrentSettings();
    answered=0; correctCount=0; wrongAttempts=0;
    buildBoard(); stopTimer(); startTimer();
  };
 </script>
</body>
</html>






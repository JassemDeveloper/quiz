<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ® Ù„Ø¹Ø¨Ø© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© â€” ØµÙˆØª Ù…Ù„ÙÙŠ Ù‚ØµÙŠØ±</title>
  <style>
    :root{
      --bg:#f0f8ff; --card:#ffffff; --ink:#17223b; --muted:#6b7280; --accent:#10b981; --danger:#ef4444; --brand:#3b82f6; --sky:#aee7ff;
      --shadow:0 15px 30px rgba(23,34,59,.15);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Cairo,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:var(--bg);color:var(--ink);font-size:2rem}

    /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
    #start{position:fixed;inset:0;background:linear-gradient(180deg,var(--bg),var(--sky));display:flex;align-items:center;justify-content:center;padding:30px;z-index:1000}
    .start-card{max-width:900px;width:100%;background:#ffffffcc;backdrop-filter:blur(6px);border-radius:30px;box-shadow:var(--shadow);padding:40px;text-align:center}
    .start-title{font-size:3.2rem;margin:0 0 10px}
    .start-sub{color:#0c4a6e;margin:0 0 20px}
    .name-row{display:flex;gap:16px;justify-content:center;flex-wrap:wrap;margin-top:20px}
    .name-row input{font-size:1.8rem;padding:18px 20px;border-radius:16px;border:2px solid #93c5fd;min-width:320px}

    .container{max-width:1600px;margin:auto;padding:40px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
    h1{font-size:2.4rem;margin:0;display:flex;gap:16px;align-items:center}
    .chip{font-size:1.3rem;padding:10px 18px;border-radius:999px;background:#e0f2ff;color:#0c4a6e}
    .card{background:var(--card);border-radius:28px;box-shadow:var(--shadow);padding:32px}
    .btn{border:0;border-radius:20px;padding:18px 28px;font-weight:700;cursor:pointer;font-size:1.4rem}
    .btn.primary{background:var(--brand);color:#fff}
    .btn.ghost{background:#e0f2ff;color:#0c4a6e}

    /* HUD */
    .hud{display:flex;justify-content:space-between;align-items:center;gap:16px;margin-bottom:20px;font-size:1.4rem}
    .hud .pill{background:#f1f5f9;color:#334155;padding:12px 20px;border-radius:999px;white-space:nowrap}
    .progress{height:18px;background:#e0f2ff;border-radius:999px;overflow:hidden;margin-bottom:20px}
    .progress>div{height:100%;background:linear-gradient(90deg,#34d399,#10b981);width:0%}

    /* Ù„ÙˆØ­ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
    #cardBoard{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px}
    .qcard{
      position:relative;background:#fff;border-radius:26px;box-shadow:0 12px 28px rgba(15,23,42,.12);
      min-height:260px;display:flex;align-items:center;justify-content:center;cursor:pointer;
      border:5px solid transparent;transition:.25s;
      background-image:radial-gradient( circle at 20% 20%, #e6f3ff 0, transparent 50% ),
                       radial-gradient( circle at 80% 80%, #e9fff6 0, transparent 50% );
    }
    .qcard:hover{transform:translateY(-6px)}
    .qcard.done{opacity:.25;pointer-events:none;transform:none}
    .qcard.correct{border-color:var(--accent)}
    .qcard.wrong{border-color:var(--danger)}
    .qcard .centerMark{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;padding:14px}
    .qcard .centerMark .num{font-size:5.2rem;font-weight:900;line-height:1;color:#0c4a6e;text-shadow:0 4px 12px rgba(2,6,23,.08)}
    .qcard .centerMark img{width:88px;height:88px;object-fit:contain;opacity:.95;filter:drop-shadow(0 6px 14px rgba(2,6,23,.12))}

    /* Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„ */
    #qModal{position:fixed;inset:0;background:rgba(15,23,42,.35);display:none;align-items:center;justify-content:center;z-index:1100}
    #qBox{background:#fff;border-radius:26px;box-shadow:var(--shadow);width:min(1020px,95vw);max-height:90vh;overflow:auto}
    #qHead{display:flex;justify-content:space-between;align-items:center;padding:18px 22px;border-bottom:1px solid #e5e7eb}
    #qTitle{font-size:1.4rem;margin:0}
    #qBody{padding:16px 22px}
    .question{font-size:3.6rem;font-weight:900;margin:14px 0 22px;text-align:center;line-height:1.25}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
    .choice{position:relative;border:4px solid transparent;border-radius:18px;background:#ffffff;cursor:pointer;transition:.25s;box-shadow:0 10px 24px rgba(17,24,39,.12);font-size:1.6rem}
    .choice:hover{transform:translateY(-4px)}
    .choice.is-correct{border-color:var(--accent)}
    .choice.is-wrong{border-color:var(--danger)}
    .choice[disabled]{opacity:.5;filter:grayscale(.1);cursor:not-allowed}
    .choice .thumb{height:200px;display:flex;align-items:center;justify-content:center;background:#f8fafc;border-radius:14px 14px 0 0;overflow:hidden}
    .choice .thumb img{max-width:100%;max-height:100%}
    .choice .label{padding:14px 16px;font-weight:700;text-align:center}

    /* Ø§Ù‡ØªØ²Ø§Ø² Ø®Ø·Ø£ */
    @keyframes shakeX {0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
    .shake{animation:shakeX .35s ease}

    .result{display:none;text-align:center;padding:40px;font-size:1.6rem}
    .result h2{font-size:2.4rem;margin:0 0 20px}
    .stats{display:flex;flex-wrap:wrap;gap:16px;justify-content:center;margin-top:16px}
    .stat{background:#f8fafc;border:2px solid #e0f2ff;border-radius:18px;padding:14px 18px;font-size:1.4rem}

    /* ØµÙˆØ± ÙˆØªØ£Ø«ÙŠØ±Ø§Øª */
    .happy-img, .sad-img {position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; z-index: 1202; width: min(420px, 70vw); height: auto; max-height: 70vh}
    #clapOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(240,248,255,.6);z-index:1201}
    #clapOverlay img{width:360px;height:360px;animation:pulse .7s ease-in-out infinite alternate}
    @keyframes pulse{from{transform:scale(.92)}to{transform:scale(1.06)}}

    /* Ù‚ÙˆØ³ Ù‚Ø²Ø­ + Ù†Ø¬ÙˆÙ… */
    #celebrate{pointer-events:none;position:fixed;inset:0;z-index:1200}
    #celebrate #rainbow{position:absolute;left:0;right:0;top:-120vh;height:120vh;opacity:.85;filter:saturate(1.2) blur(1px);background:linear-gradient(180deg,#ff3b30,#ff9500,#ffd60a,#34c759,#64d2ff,#0a84ff,#bf5af2);transform:translateY(-120vh)}
    .rainbow-run{animation:rainbowDrop 1.3s ease-out forwards}
    @keyframes rainbowDrop{0%{transform:translateY(-120vh)}70%{transform:translateY(20vh)}100%{transform:translateY(120vh);opacity:0}}
    .star{position:absolute;font-size:32px;opacity:0;filter:drop-shadow(0 6px 6px rgba(0,0,0,.15));will-change:transform,opacity;}
    @keyframes starFall{0%{transform:translateY(-40px) scale(.6) rotate(0deg);opacity:0}10%{opacity:1}70%{transform:translateY(60vh) scale(1) rotate(160deg)}100%{transform:translateY(100vh) scale(.9) rotate(260deg);opacity:0}}

    /* ÙˆÙ„Ø¯ ÙŠØ±Ù‚Øµ */
    @keyframes dance {0%{transform:translate(-50%,-50%) rotate(0) scale(1)}50%{transform:translate(-50%,-50%) rotate(8deg) scale(1.08)}100%{transform:translate(-50%,-50%) rotate(0) scale(1);opacity:0}}
    .dance-run{animation:dance 1.6s ease-in-out forwards;filter:drop-shadow(0 10px 25px rgba(0,0,0,.18));}

    /* Toast */
    #toast{position:fixed; left:50%; top:24px; transform:translateX(-50%) translateY(-20px); background:#ffffff; color:#0f172a; border:2px solid #e2e8f0; border-radius:16px; padding:12px 18px; box-shadow:0 10px 24px rgba(2,6,23,.12); font-size:1.4rem; z-index:1305; opacity:0; pointer-events:none; display:flex; align-items:center; gap:10px; white-space:nowrap;}
    #toast.ok{border-color:#86efac}
    #toast.err{border-color:#fecaca}
    .toast-show{animation:toastIn .25s ease-out forwards}
    .toast-hide{animation:toastOut .25s ease-in forwards}
    @keyframes toastIn{from{opacity:0; transform:translateX(-50%) translateY(-20px)} to{opacity:1; transform:translateX(-50%) translateY(0)}}
    @keyframes toastOut{from{opacity:1; transform:translateX(-50%) translateY(0)} to{opacity:0; transform:translateX(-50%) translateY(-20px)}}

    @media (max-width:640px){
      body{font-size:1.4rem}
      .container{padding:20px}
      .question{font-size:2.2rem}
      #cardBoard{grid-template-columns:repeat(2,1fr);gap:14px}
      .qcard{min-height:200px}
      .choice .thumb{height:170px}
      .btn{padding:16px 18px;font-size:1.2rem}
      .qcard .centerMark .num{ font-size:3.6rem }
      .qcard .centerMark img{ width:64px; height:64px }
    }

    /* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© */
    #adminPanel{ display:none; position:fixed; inset:0; background:rgba(15,23,42,.35); z-index:1300; align-items:center; justify-content:center; padding:20px; }
    #adminBox{ background:#fff; width:min(1000px,95vw); max-height:90vh; overflow:auto; border-radius:24px; box-shadow:var(--shadow); padding:20px; }
    #adminBox h3{ margin:0; font-size:1.4rem; color:#0f172a }
    #qJson{
      width:100%; min-height:340px; padding:14px 16px; border:1px solid #e5e7eb; border-radius:14px;
      background:#fbfdff; font-family:ui-monospace, Menlo, Consolas, monospace;
      font-size:0.95rem; line-height:1.6; direction:ltr; text-align:left; box-shadow:inset 0 1px 0 rgba(2,6,23,.02); margin-top:8px;
    }
    #adminBox .row{ display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:12px; align-items:end; margin-top:12px; }
    #adminBox .row label{ display:flex; align-items:center; gap:10px; background:#f8fafc; border:1px solid #e5e7eb; padding:10px 12px; border-radius:12px; color:#334155; font-size:0.95rem; }
    #adminBox .row input[type="number"], #adminBox .row input[type="text"], #adminBox .row select{ width:100%; padding:10px 12px; border:1px solid #e5e7eb; border-radius:10px; background:#fff; font-size:0.95rem; }
    .admin-actions{ display:flex; flex-wrap:wrap; gap:10px; margin:12px 0 6px; }
    .admin-actions .btn{ padding:12px 16px; font-size:1rem; border-radius:12px }
    .tiny{ font-size:.85rem; color:#64748b }
  </style>
</head>
<body>
  <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
  <section id="start">
    <div class="start-card">
      <div style="font-size:4rem">ğŸŒŸ</div>
      <h2 class="start-title">Ù„Ø¹Ø¨Ø© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ù…ØªØ¹Ø©</h2>
      <p class="start-sub">Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø«Ù… Ø§Ø¶ØºØ· Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</p>
      <div class="name-row">
        <input id="playerName" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ ÙŠØ§ Ø¨Ø·Ù„" />
        <button class="btn primary" id="goBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
      </div>
    </div>
  </section>

  <div class="container">
    <header>
      <h1>ğŸ® Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„ <span class="chip">Ø¨Ø·Ø§Ù‚Ø§Øª</span></h1>
      <div style="display:flex;align-items:center;gap:12px">
        <button class="btn ghost" id="adminBtn" title="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</button>
      </div>
    </header>

    <section id="game" class="card" style="display:none">
      <div class="hud">
        <div class="pill" id="timer">â±ï¸ 00:00</div>
        <div class="pill" id="firstTry">âœ… Ø¨Ø·Ø§Ù‚Ø§Øª ØµØ­ÙŠØ­Ø©: 0</div>
        <div class="pill" id="wrongHud">âŒ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø®Ø§Ø·Ø¦Ø©: 0</div>
        <div class="pill" id="qIndex">Ø¨Ø·Ø§Ù‚Ø§Øª Ù…ØªØ¨Ù‚ÙŠØ©: 0</div>
      </div>
      <div class="progress"><div id="progressBar"></div></div>
      <div id="cardBoard"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:16px;color:#64748b">
        <div>Ø§Ø®ØªØ± Ø¨Ø·Ø§Ù‚Ø©ØŒ Ø£Ø¬Ø¨ØŒ Ø¥Ù† ÙƒØ§Ù†Øª Ø®Ø§Ø·Ø¦Ø© Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. ØªØ®ØªÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©.</div>
        <button class="btn ghost" id="restart">ğŸ” Ø¥Ø¹Ø§Ø¯Ø©</button>
      </div>
    </section>

    <section id="result" class="card" style="display:none;text-align:center">
      <h2 id="resultTitle">ğŸ‰ Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</h2>
      <p id="resultText">â€¦</p>
      <div class="stats">
        <div class="stat">â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚: <b id="resultTime">00:00</b></div>
        <div class="stat">âœ… Ø¨Ø·Ø§Ù‚Ø§Øª ØµØ­ÙŠØ­Ø©: <b id="resultFirstTries">0</b></div>
        <div class="stat">ğŸ“š Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª: <b id="resultTotal">0</b></div>
        <div class="stat">âŒ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©: <b id="resultWrongCount">0</b></div>
      </div>
      <div style="margin-top:28px;display:flex;gap:16px;justify-content:center">
        <button class="btn primary" id="playAgain">ğŸ¯ Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
      </div>
    </section>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„ -->
  <div id="qModal" aria-hidden="true">
    <div id="qBox">
      <div id="qHead"><h3 id="qTitle">Ø§Ù„Ø³Ø¤Ø§Ù„</h3></div>
      <div id="qBody">
        <div class="question" id="questionText">â€¦</div>
        <div class="grid" id="choices"></div>
      </div>
    </div>
  </div>

  <!-- ØªØ£Ø«ÙŠØ±Ø§Øª -->
  <img src="https://cdn-icons-png.flaticon.com/512/4140/4140048.png" class="happy-img" id="happyImg" alt="happy boy">
  <img src="https://cdn-icons-png.flaticon.com/512/4140/4140037.png" class="sad-img" id="sadImg" alt="sad boy">
  <div id="clapOverlay"><img src="https://cdn-icons-png.flaticon.com/512/3159/3159310.png" alt="ØªØµÙÙŠÙ‚"></div>
  <div id="celebrate" aria-hidden="true"><div id="rainbow"></div></div>
  <img src="https://cdn-icons-png.flaticon.com/512/4140/4140048.png" id="danceBoy" alt="ÙˆÙ„Ø¯ ÙŠØ±Ù‚Øµ"
       style="display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); width:min(420px,70vw); height:auto; z-index:1203;">

  <!-- Toast -->
  <div id="toast"><span id="toastIcon">ğŸ‰</span><span id="toastMsg">...</span></div>

  <!-- ØµÙˆØª Ù…Ù„ÙÙ‘ÙŠ Ù‚ØµÙŠØ± (ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† ÙˆÙŠÙ†Ø¯ÙˆØ²/TTS) -->
<audio id="okVoice" preload="auto" playsinline></audio>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© -->
  <div id="adminPanel">
    <div id="adminBox">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px">
        <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</h3>
        <button class="btn ghost" id="adminClose">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <p class="tiny">Ø¹Ø¯Ù‘Ù„ Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨ØµÙŠØºØ© JSON (question + answers[{text,image,isCorrect}]).</p>
      <textarea id="qJson" spellcheck="false"></textarea>
      <div class="row" style="margin-top:10px">
        <label class="switch"><input type="checkbox" id="optShuffle" checked> Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ø®ÙŠØ§Ø±Ø§Øª</label>
        <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª: <input type="number" id="optLimit" min="1" step="1" placeholder="Ø¨Ø¯ÙˆÙ† Ø­Ø¯"></label>
      </div>
      <div class="admin-actions">
        <button class="btn primary" id="applyBtn">ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        <button class="btn ghost" id="exportBtn">ğŸ“¤ ØªØµØ¯ÙŠØ± JSON</button>
        <input type="file" id="importFile" accept="application/json" style="display:none">
        <button class="btn ghost" id="importBtn">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON</button>
        <button class="btn ghost" id="resetBtn" title="Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ">Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>

        <!-- ØªØ¹ÙŠÙŠÙ†/Ø¥Ø²Ø§Ù„Ø© ØµÙˆØª Ø§Ù„ØªØ´Ø¬ÙŠØ¹ -->
        <input type="file" id="okVoiceFile" accept="audio/*" style="display:none">
        <button class="btn ghost" id="okVoicePick">ğŸ™ï¸ ØªØ¹ÙŠÙŠÙ† ØµÙˆØª Ø§Ù„ØªØ´Ø¬ÙŠØ¹ (MP3/OGG)</button>
        <button class="btn ghost" id="okVoiceClear">ğŸ—‘ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØª</button>
      </div>
      <p class="tiny">ÙŠÙØ­ÙØ¸ Ø§Ù„ØµÙˆØª Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆÙŠØ¹Ù…Ù„ Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª. ÙŠÙÙˆÙ‚Ù ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¥Ù† ØªØ¬Ø§ÙˆØ² 2.4 Ø«Ø§Ù†ÙŠØ©.</p>
    </div>
  </div>

  <script>
    function qs(s, r){return (r||document).querySelector(s)}
    function shuffle(arr){return arr.slice().sort(function(){return Math.random()-0.5})}
    function rand(arr){return arr[Math.floor(Math.random()*arr.length)]}

    var QUESTIONS=[], CARDS=[], answered=0, correctCount=0, wrongAttempts=0, startAt=0, timerId=null, playerName='';
    var ADMIN_CODE='1234';

    /* ØµÙˆØ± Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ù†Øµ */
    var ICONS = {
      'Ù‚Ø·Ø©':'https://cdn-icons-png.flaticon.com/512/1998/1998592.png',
      'ÙƒÙ„Ø¨':'https://cdn-icons-png.flaticon.com/512/1998/1998673.png',
      'Ø¨Ù‚Ø±Ø©':'https://cdn-icons-png.flaticon.com/512/1998/1998610.png',
      'Ø£Ø³Ø¯':'https://cdn-icons-png.flaticon.com/512/1998/1998627.png',
      'Ø·Ø§Ø¦Ø±':'https://cdn-icons-png.flaticon.com/512/1998/1998617.png',
      'Ø³Ù…ÙƒØ©':'https://cdn-icons-png.flaticon.com/512/1998/1998676.png',
      'Ù†Ù…Ø±':'https://cdn-icons-png.flaticon.com/512/1998/1998679.png',
      'Ø¬Ù…Ù„':'https://cdn-icons-png.flaticon.com/512/1998/1998612.png',
      'ØªÙØ§Ø­':'https://cdn-icons-png.flaticon.com/512/742/742751.png',
      'Ù…ÙˆØ²':'https://cdn-icons-png.flaticon.com/512/415/415733.png',
      'Ø¹Ù†Ø¨':'https://cdn-icons-png.flaticon.com/512/766/766013.png',
      'Ø¨Ø±ØªÙ‚Ø§Ù„':'https://cdn-icons-png.flaticon.com/512/415/415734.png',
      'ÙØ±Ø§ÙˆÙ„Ø©':'https://cdn-icons-png.flaticon.com/512/135/135620.png',
      'Ø£Ø®Ø¶Ø±':'https://cdn-icons-png.flaticon.com/512/2913/2913399.png',
      'Ø£Ø²Ø±Ù‚':'https://cdn-icons-png.flaticon.com/512/2913/2913382.png',
      'Ø£Ø­Ù…Ø±':'https://cdn-icons-png.flaticon.com/512/2913/2913385.png',
      'Ø£ØµÙØ±':'https://cdn-icons-png.flaticon.com/512/2913/2913403.png',
      'ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡':'https://cdn-icons-png.flaticon.com/512/1146/1146869.png',
      'ÙÙŠ Ø§Ù„Ø¨Ø­Ø±':'https://cdn-icons-png.flaticon.com/512/3075/3075977.png',
      'Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶':'https://cdn-icons-png.flaticon.com/512/9131/9131530.png',
      'Ù‚Ù„Ù…':'https://cdn-icons-png.flaticon.com/512/2647/2647789.png',
      'Ù…Ù…Ø­Ø§Ø©':'https://cdn-icons-png.flaticon.com/512/4221/4221403.png',
      'Ù…Ù‚Øµ':'https://cdn-icons-png.flaticon.com/512/3131/3131607.png'
    };

    /* Ø±Ø³Ø§Ø¦Ù„ */
    var MSG_OK = [ 'Ø±Ø§Ø¦Ø¹ ÙŠØ§ Ø¨Ø·Ù„!' ];
    var MSG_ERR = [
      'Ù„Ø§ Ø¨Ø£Ø³ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ÙŠØ§ Ø¨Ø·Ù„! ğŸ’ª',
      'Ù„Ø§ ØªÙŠØ£Ø³ ÙŠØ§ Ø¨Ø·Ù„ØŒ Ø³ØªÙ†Ø¬Ø­! ğŸŒŸ',
      'Ø£Ù†Øª Ù‚Ø§Ø¯Ø± Ø¹Ù„ÙŠÙ‡Ø§! Ø¬Ø±Ù‘Ø¨ Ù…Ø¬Ø¯Ø¯Ù‹Ø§! ğŸ™Œ'
    ];

    /* Ù…Ø¤Ù‚Øª ÙˆHUD */
    var timerEl=qs('#timer'), firstTryEl=qs('#firstTry'), wrongHudEl=qs('#wrongHud'), qIndexEl=qs('#qIndex'), progressBar=qs('#progressBar');
    function fmtTime(ms){var s=Math.floor(ms/1000),m=Math.floor(s/60),r=s%60;return (m<10?'0'+m:m)+':'+(r<10?'0'+r:r)}
    function startTimer(){startAt=performance.now(); tick()}
    function tick(){timerEl.textContent='â±ï¸ '+fmtTime(performance.now()-startAt); timerId=requestAnimationFrame(tick)}
    function stopTimer(){ if(timerId) cancelAnimationFrame(timerId); timerId=null }

    /* ØªØ£Ø«ÙŠØ±Ø§Øª Ù…Ø±Ø¦ÙŠØ© */
    function showHappy(){ var el=qs('#happyImg'); el.style.display='block'; setTimeout(function(){ el.style.display='none'},1500) }
    function showSad(){ var el=qs('#sadImg'); el.style.display='block'; setTimeout(function(){ el.style.display='none'},900) }
    function showClap(){ var el=qs('#clapOverlay'); el.style.display='flex'; setTimeout(function(){ el.style.display='none'},1300) }
    function celebrateRainbowStars(){
      var wrap=qs('#celebrate'), rainbow=qs('#rainbow'); if(!wrap||!rainbow) return;
      rainbow.classList.remove('rainbow-run'); void rainbow.offsetWidth; rainbow.classList.add('rainbow-run');
      Array.from(wrap.querySelectorAll('.star')).forEach(function(n){n.remove()});
      for(var i=0;i<18;i++){ var s=document.createElement('div'); s.className='star';
        s.textContent=(Math.random()<0.33?'âœ¨':(Math.random()<0.5?'â­':'ğŸŒŸ'));
        s.style.left=Math.round(Math.random()*95)+'%'; s.style.top='-20px'; s.style.fontSize=(24+Math.random()*22)+'px';
        var delay=(Math.random()*0.3).toFixed(2)+'s', dur=(1.1+Math.random()*0.8).toFixed(2)+'s';
        s.style.animation='starFall '+dur+' ease-out '+delay+' forwards'; wrap.appendChild(s);
      }
      setTimeout(function(){ Array.from(wrap.querySelectorAll('.star')).forEach(function(n){n.remove()}) }, 2200);
    }
    function showDanceBoy(){
      var el=qs('#danceBoy'); if(!el) return;
      el.style.display='block'; el.classList.remove('dance-run'); void el.offsetWidth; el.classList.add('dance-run');
      setTimeout(function(){ el.style.display='none' },1650);
    }

    /* Toast */
    var toast = null, toastMsg=null, toastIcon=null, toastTimer=null;
    function setupToast(){ toast=qs('#toast'); toastMsg=qs('#toastMsg'); toastIcon=qs('#toastIcon'); }
    function showToast(message, kind){
      if(!toast) setupToast();
      toast.classList.remove('ok','err','toast-hide'); toast.classList.add(kind||'ok');
      toastMsg.textContent = message || '';
      toastIcon.textContent = (kind==='err' ? 'ğŸ’¡' : 'ğŸ‰');
      toast.style.opacity='0'; toast.style.display='flex';
      void toast.offsetWidth;
      toast.classList.add('toast-show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(function(){
        toast.classList.remove('toast-show'); toast.classList.add('toast-hide');
        setTimeout(function(){ toast.style.display='none'; }, 240);
      }, 1400);
    }

    /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ (ÙˆØ§Ø¬Ù‡Ø©) */
    var QMARK = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><rect width="100%25" height="100%25" rx="28" ry="28" fill="%23e6f3ff"/><text x="50%25" y="54%25" dominant-baseline="middle" text-anchor="middle" font-size="110" font-family="Cairo,Arial,sans-serif" fill="%230c4a6e">ØŸ</text></svg>';

    function buildBoard(){
      var board=qs('#cardBoard'); board.innerHTML='';
      CARDS=QUESTIONS.map(function(q,idx){
        var c=document.createElement('button'); c.className='qcard'; c.setAttribute('data-i',idx);
        c.innerHTML='<div class="centerMark"><div class="num">'+(idx+1)+'</div><img src="'+QMARK+'" alt="Ø³Ø¤Ø§Ù„ ØŸ"></div>';
        c.onclick=function(){ openQuestion(idx,c) };
        board.appendChild(c); return c;
      });
      updateHud();
    }
    function updateHud(){
      var total=QUESTIONS.length, remain=total-answered;
      firstTryEl.textContent='âœ… Ø¨Ø·Ø§Ù‚Ø§Øª ØµØ­ÙŠØ­Ø©: '+correctCount;
      wrongHudEl.textContent='âŒ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø®Ø§Ø·Ø¦Ø©: '+wrongAttempts;
      qIndexEl.textContent='Ø¨Ø·Ø§Ù‚Ø§Øª Ù…ØªØ¨Ù‚ÙŠØ©: '+remain;
      progressBar.style.width = Math.round((answered/Math.max(1,total))*100) + '%';
    }

    function openQuestion(index, cardEl){
      var q=QUESTIONS[index]; if(!q) return;
      var modal=qs('#qModal'); var title=qs('#qTitle'); var qText=qs('#questionText'); var host=qs('#choices');
      title.textContent='Ø§Ù„Ø³Ø¤Ø§Ù„ #' + (index+1);
      qText.textContent=q.question;
      host.innerHTML='';
      q.answers.forEach(function(a){
        var src = ICONS[a.text] || a.image || '';
        var b=document.createElement('button'); b.className='choice';
        var imgHtml = src ? "<img src='"+src+"' alt='"+a.text+"'>" : 'ğŸ²';
        b.innerHTML="<div class='thumb'>"+imgHtml+"</div><div class='label'>"+a.text+"</div>";
        b.onclick=function(){ answerWithRetries(b, !!a.isCorrect, cardEl, index) };
        host.appendChild(b);
      });
      modal.style.display='flex';
    }

 // ===== ØµÙˆØª Ù…Ù„ÙÙ‘ÙŠ Ù‚ØµÙŠØ± â€” Ù…ÙˆØ«ÙˆÙ‚ ÙˆÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª =====
var MAX_TTS_MS = 2400; // Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ù„ØªØ´ØºÙŠÙ„ 2.4 Ø«Ø§Ù†ÙŠØ©
var okVoiceEl = document.getElementById('okVoice');

// Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù‚ÙˆÙŠ (â‰ˆ 2 Ø«) â€” ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ø±ÙØ¹ Ù…Ù„ÙÙƒ (ÙŠÙØ®Ø²Ù† Ù…Ø­Ù„ÙŠÙ‹Ø§)
var DEFAULT_OK_MP3 = "https://cdn.pixabay.com/download/audio/2022/03/15/audio_6f2c6e-children-yay-18527.mp3?filename=children-yay-18527.mp3";

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ØµØ¯Ø±: Ø¥Ù† ÙˆÙØ¬Ø¯ Ù…Ù„Ù Ù…Ø±ÙÙˆØ¹ Ù…Ø­Ù„ÙŠÙ‹Ø§ (Base64) Ù†Ø³ØªØ®Ø¯Ù…Ù‡ØŒ ÙˆØ¥Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
(function initOkVoice(){
  try{
    var saved = localStorage.getItem('OK_VOICE_SRC');
    okVoiceEl.src = saved ? saved : DEFAULT_OK_MP3;
    okVoiceEl.preload = 'auto';
    okVoiceEl.muted = false;
    okVoiceEl.volume = 1;
    // Ø¥Ø¬Ø¨Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ù…Ø¨ÙƒØ±
    okVoiceEl.load();
  }catch(e){}
})();

function setOkVoice(src){
  try{
    okVoiceEl.src = src;            // Base64 Ù…Ù† Ø§Ù„Ø±ÙØ¹
    okVoiceEl.preload = 'auto';
    okVoiceEl.muted = false;
    okVoiceEl.volume = 1;
    okVoiceEl.load();
    localStorage.setItem('OK_VOICE_SRC', src);
  }catch(e){}
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ù…Ø¹ Ø­Ø§Ø±Ø³ Ø²Ù…Ù†ÙŠ + Ø¨Ø¯ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ÙØ´Ù„
function playOkVoiceThen(next){
  var el = okVoiceEl;
  if(!el || !el.src){ if(next) next(); return; }

  var finished = false;
  function done(){
    if(finished) return;
    finished = true;
    try{ el.pause(); }catch(e){}
    if(next) next();
  }
  var guard = setTimeout(done, MAX_TTS_MS);

  function tryPlayElement(){
    try{
      el.currentTime = 0;
      el.onended = function(){ clearTimeout(guard); done(); };
      var p = el.play();
      if(p && typeof p.then === 'function'){
        p.then(function(){}).catch(function(){ playFallback(); });
      }
    }catch(e){ playFallback(); }
  }

  // Ù„Ùˆ Ù…Ø§ ØµØ§Ø± Ø¬Ø§Ù‡Ø² â€” Ø§Ù†ØªØ¸Ø± Ø­Ø¯Ø« Ø§Ù„ØªØ­Ù…ÙŠÙ„
  if(el.readyState < 2){
    var once = function(){
      el.removeEventListener('canplaythrough', once);
      el.removeEventListener('loadeddata', once);
      tryPlayElement();
    };
    el.addEventListener('canplaythrough', once, {once:true});
    el.addEventListener('loadeddata', once, {once:true});
    try{ el.load(); }catch(e){}
  }else{
    tryPlayElement();
  }

  // Ø¨Ø¯ÙŠÙ„: Ø¥Ù†Ø´Ø§Ø¡ Audio Ù…Ø¤Ù‚Øª Ø¨Ù†ÙØ³ Ø§Ù„Ù…ØµØ¯Ø± (ÙŠØ­Ù„ Ù…Ø´Ø§ÙƒÙ„ Ù…ØªØµÙØ­Ø§Øª Ù…Ø¹ÙŠÙ†Ø©)
  function playFallback(){
    try{
      var tmp = new Audio(el.src);
      tmp.playsInline = true;
      tmp.muted = false;
      tmp.volume = 1;
      tmp.preload = 'auto';
      tmp.onended = function(){ clearTimeout(guard); done(); };
      var pp = tmp.play();
      if(pp && typeof pp.then === 'function'){
        pp.then(function(){}).catch(function(){ clearTimeout(guard); done(); });
      }
    }catch(e){ clearTimeout(guard); done(); }
  }
}


    function answerWithRetries(btn, ok, cardEl, index){
      var choicesWrap=qs('#choices');
      if(ok){
        choicesWrap.querySelectorAll('.choice').forEach(function(ch){ ch.disabled=true });
        btn.classList.add('is-correct'); cardEl.classList.add('correct');
        correctCount++; answered++;

        var msgOk = rand(MSG_OK);
        showHappy(); showClap(); celebrateRainbowStars(); showDanceBoy();
        showToast(msgOk, 'ok');

        // Ø´ØºÙ‘Ù„ Ø§Ù„ØµÙˆØª Ø§Ù„Ù‚ØµÙŠØ± Ø«Ù… Ø§Ù†ØªÙ‚Ù„
playOkVoiceThen(function(){
  var modal = qs('#qModal');
  if(cardEl && cardEl.parentNode){ cardEl.classList.add('done'); cardEl.remove(); }
  updateHud();
  modal.style.display = 'none';
  if(answered >= QUESTIONS.length){ finish(); }
});

      }else{
        btn.classList.add('is-wrong','shake');
        btn.disabled=true;
        setTimeout(function(){ btn.classList.remove('shake') }, 350);
        wrongAttempts++;

        var msgErr = rand(MSG_ERR);
        showSad();
        showToast(msgErr, 'err');
        setTimeout(function(){ updateHud(); btn.disabled=false; }, 900);
      }
    }

    function finish(){
      stopTimer();
      var total=QUESTIONS.length||1;
      qs('#resultTime').textContent=fmtTime(performance.now()-startAt);
      qs('#resultFirstTries').textContent=correctCount;
      qs('#resultTotal').textContent=total;
      qs('#resultWrongCount').textContent=wrongAttempts;
      var congrats = playerName ? ('ğŸ‰ Ø£Ø­Ø³Ù†Øª ÙŠØ§ '+playerName+'!') : 'ğŸ‰ Ø£Ø­Ø³Ù†Øª!';
      qs('#resultTitle').textContent = congrats + ' Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª';
      qs('#resultText').textContent = (wrongAttempts===0) ? 'Ù…Ø°Ù‡Ù„! Ù„Ù… ØªÙØ®Ø·Ø¦ Ø£ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© ğŸ‘' : 'Ø¹Ù…Ù„ Ø±Ø§Ø¦Ø¹! Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¹Ù„Ù…ØªÙ†Ø§ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„ØµØ­ÙŠØ­ ğŸ’ª';
      qs('#game').style.display='none';
      qs('#result').style.display='block';
    }

    /* Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© */
    var DEFAULT_QUESTIONS = [
      {"question":"Ù…Ø§ Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø§Ù„Ø°ÙŠ ÙŠÙ‚ÙˆÙ„ Ù…ÙˆØ§Ø¡ØŸ","answers":[
        {"text":"Ù‚Ø·Ø©","image":"https://cdn-icons-png.flaticon.com/512/1998/1998592.png","isCorrect":true},
        {"text":"ÙƒÙ„Ø¨","image":"https://cdn-icons-png.flaticon.com/512/1998/1998673.png","isCorrect":false},
        {"text":"Ø¨Ù‚Ø±Ø©","image":"https://cdn-icons-png.flaticon.com/512/1998/1998610.png","isCorrect":false}
      ]},
      {"question":"Ù…Ø§ Ø§Ù„ÙØ§ÙƒÙ‡Ø© Ø§Ù„ØªÙŠ Ù„ÙˆÙ†Ù‡Ø§ Ø£ØµÙØ±ØŸ","answers":[
        {"text":"Ù…ÙˆØ²","image":"https://cdn-icons-png.flaticon.com/512/415/415733.png","isCorrect":true},
        {"text":"ØªÙØ§Ø­","image":"https://cdn-icons-png.flaticon.com/512/742/742751.png","isCorrect":false},
        {"text":"Ø¹Ù†Ø¨","image":"https://cdn-icons-png.flaticon.com/512/766/766013.png","isCorrect":false}
      ]},
      {"question":"Ø£ÙŠÙ† Ù†Ø±Ù‰ Ø§Ù„Ù‚Ù…Ø±ØŸ","answers":[
        {"text":"ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡","image":"https://cdn-icons-png.flaticon.com/512/1146/1146869.png","isCorrect":true},
        {"text":"ÙÙŠ Ø§Ù„Ø¨Ø­Ø±","image":"https://cdn-icons-png.flaticon.com/512/3075/3075977.png","isCorrect":false},
        {"text":"Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶","image":"https://cdn-icons-png.flaticon.com/512/9131/9131530.png","isCorrect":false}
      ]},
      {"question":"Ù…Ø§ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ Ù†Ø³ØªØ®Ø¯Ù…Ù‡ ÙÙŠ Ø§Ù„ÙƒØªØ§Ø¨Ø©ØŸ","answers":[
        {"text":"Ù‚Ù„Ù…","image":"https://cdn-icons-png.flaticon.com/512/2647/2647789.png","isCorrect":true},
        {"text":"Ù…Ù…Ø­Ø§Ø©","image":"https://cdn-icons-png.flaticon.com/512/4221/4221403.png","isCorrect":false},
        {"text":"Ù…Ù‚Øµ","image":"https://cdn-icons-png.flaticon.com/512/3131/3131607.png","isCorrect":false}
      ]}
    ];

    /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† */
    var adminBtn=qs('#adminBtn'), adminClose=null,
        qJson=qs('#qJson'), optShuffle=qs('#optShuffle'), optLimit=qs('#optLimit'),
        applyBtn=qs('#applyBtn'), exportBtn=qs('#exportBtn'), importBtn=qs('#importBtn'),
        importFile=qs('#importFile'), resetBtn=qs('#resetBtn');

    function parseQuestions(){
      try{
        var data = JSON.parse(qJson.value);
        if(!Array.isArray(data) || !data.length) throw new Error('Ù‚Ø§Ø¦Ù…Ø© Ø£Ø³Ø¦Ù„Ø© ÙØ§Ø±ØºØ©');
        return data;
      }catch(e){ alert('JSON ØºÙŠØ± ØµØ§Ù„Ø­: '+ e.message); return null; }
    }
    function saveAdminState(){
      localStorage.setItem('ADMIN_QUESTIONS', qJson.value);
      localStorage.setItem('ADMIN_SHUFFLE', String(optShuffle.checked));
      if(optLimit.value) localStorage.setItem('ADMIN_LIMIT', String(optLimit.value));
      else localStorage.removeItem('ADMIN_LIMIT');
    }
    function loadAdminState(){
      var saved = localStorage.getItem('ADMIN_QUESTIONS');
      qJson.value = saved ? saved : JSON.stringify(DEFAULT_QUESTIONS, null, 2);
      var s = localStorage.getItem('ADMIN_SHUFFLE');
      optShuffle.checked = (s===null) ? true : (s==='true');
      var lim = localStorage.getItem('ADMIN_LIMIT');
      optLimit.value = lim ? lim : '';
    }
    function applyQuestionsToGame(){
      var data = parseQuestions(); if(!data) return;
      saveAdminState();
      var limit = parseInt(optLimit.value||data.length,10);
      var arr = data.slice(0, Math.max(1, Math.min(limit, data.length)));
      var doShuffle = !!optShuffle.checked;
      if(doShuffle){
        arr = shuffle(arr).map(function(q){ q.answers = shuffle(q.answers||[]); return q; });
      }else{
        arr = arr.map(function(q){ q.answers = (q.answers||[]); return q; });
      }
      QUESTIONS = arr;
      answered=0; correctCount=0; wrongAttempts=0;
      document.getElementById('adminPanel').style.display='none';
      document.getElementById('result').style.display='none';
      document.getElementById('game').style.display='block';
      buildBoard();
      stopTimer(); startTimer();
    }

    // Ø±ÙØ¹/Ø¥Ø²Ø§Ù„Ø© ØµÙˆØª Ø§Ù„ØªØ´Ø¬ÙŠØ¹
var okVoicePick = document.getElementById('okVoicePick');
var okVoiceFile = document.getElementById('okVoiceFile');
var okVoiceClear = document.getElementById('okVoiceClear');

if(okVoicePick && okVoiceFile){
  okVoicePick.onclick = function(){ okVoiceFile.click(); };
  okVoiceFile.onchange = function(){
    var f = okVoiceFile.files[0];
    if(!f) return;
    if(!/^audio\//.test(f.type)){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØªÙŠ'); return; }
    var r = new FileReader();
    r.onload = function(){ setOkVoice(r.result); alert('ØªÙ… ØªØ¹ÙŠÙŠÙ† ØµÙˆØª Ø§Ù„ØªØ´Ø¬ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­'); };
    r.readAsDataURL(f); // ÙŠØ®Ø²Ù‘ÙÙ† Ù…Ø­Ù„ÙŠÙ‹Ø§ â€” ÙŠØ¹Ù…Ù„ Ø¨Ù„Ø§ Ø¥Ù†ØªØ±Ù†Øª
  };
}
if(okVoiceClear){
  okVoiceClear.onclick = function(){
    try{ localStorage.removeItem('OK_VOICE_SRC'); }catch(e){}
    if(okVoiceEl){ okVoiceEl.src = OK_VOICE_DATAURI; } // Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…Ø¯Ù…Ø¬
    alert('ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø®ØµÙ‘Øµ (Ø¹Ø§Ø¯ Ù„Ù„ØµÙˆØª Ø§Ù„Ù…Ø¯Ù…Ø¬)');
  };
}

    // Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    document.getElementById('adminBtn').onclick=function(){
      var code=prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„ÙØªØ­ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© (Ø§ÙØªØ±Ø§Ø¶ÙŠ: 1234):');
      if(code===null) return;
      if(code!==ADMIN_CODE){ alert('Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­'); return; }
      loadAdminState();
      document.getElementById('adminPanel').style.display='flex';
    };
    document.getElementById('adminClose') && (document.getElementById('adminClose').onclick=function(){ document.getElementById('adminPanel').style.display='none'; });
    applyBtn && (applyBtn.onclick=applyQuestionsToGame);
    exportBtn && (exportBtn.onclick=function(){ var blob=new Blob([qJson.value], {type:'application/json'}); var a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='questions.json'; a.click(); URL.revokeObjectURL(a.href); });
    importBtn && (importBtn.onclick=function(){ importFile.click(); });
    importFile && (importFile.onchange=function(){ var f=this.files[0]; if(!f) return; var r=new FileReader(); r.onload=function(){ qJson.value=r.result; saveAdminState(); alert('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯'); }; r.readAsText(f); });
    resetBtn && (resetBtn.onclick=function(){ qJson.value = JSON.stringify(DEFAULT_QUESTIONS, null, 2); optShuffle.checked = true; optLimit.value=''; saveAdminState(); alert('ØªÙ…Øª Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ'); });

    /* Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© */
    function startWithCurrentSettings(){
      var saved = localStorage.getItem('ADMIN_QUESTIONS');
      var data = saved ? JSON.parse(saved) : DEFAULT_QUESTIONS;
      var s = localStorage.getItem('ADMIN_SHUFFLE'); var doShuffle = (s===null) ? true : (s==='true');
      var lim = parseInt(localStorage.getItem('ADMIN_LIMIT') || data.length, 10);
      lim = Math.max(1, Math.min(lim||data.length, data.length));
      var arr = data.slice(0, lim);
      if(doShuffle){
        arr = shuffle(arr).map(function(q){ q.answers = shuffle(q.answers||[]); return q; });
      }else{
        arr = arr.map(function(q){ q.answers=q.answers||[]; return q; });
      }
      QUESTIONS = arr;
    }

    document.getElementById('goBtn').onclick=function(){
      playerName = (document.getElementById('playerName').value||'Ø¨Ø·Ù„ÙŠ').trim();
      startWithCurrentSettings();
      answered=0; correctCount=0; wrongAttempts=0;
      document.getElementById('start').style.display='none';
      document.getElementById('result').style.display='none';
      document.getElementById('game').style.display='block';
      buildBoard();
      stopTimer(); startTimer();
    };

    document.getElementById('restart').onclick=function(){
      startWithCurrentSettings();
      answered=0; correctCount=0; wrongAttempts=0;
      buildBoard();
      stopTimer(); startTimer();
    };
    document.getElementById('playAgain').onclick=function(){
      document.getElementById('result').style.display='none';
      document.getElementById('game').style.display='block';
      startWithCurrentSettings();
      answered=0; correctCount=0; wrongAttempts=0;
      buildBoard();
      stopTimer(); startTimer();
    };
  </script>
</body>
</html>
